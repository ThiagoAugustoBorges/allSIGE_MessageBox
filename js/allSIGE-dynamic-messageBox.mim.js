/*
 * PLUGIN: allSIGE MessageBox
 * OWNER: Thiago Augusto Borges - Uberaba MG
 * VERSION: 2.1.0.0
 * INIT: 01/05/2016
 * LICENSE: M.I.T
 */
"use strict";!function(t){var e,o="allSIGE MessageBox - ";t.allSIGEDynamicEnvironment=function(){},t.allSIGEDynamicMessageBoxSettings=function(n,a){void 0===a?a=!1:"";var r={boxType:"none",boxShortcuts:{enabled:!0,closeKeyCode:27,showShortcutLabel:!0},boxShowIcon:!1,boxShowHeaderControls:!0,boxReloadModal:!1,boxTypeIcon:{none:{type:"img",val:"none.png"},success:{type:"img",val:"success.png"},error:{type:"img",val:"error.png"},info:{type:"img",val:"info.png"},alert:{type:"img",val:"alert.png"}},boxSize:"md",boxTitle:"allSIGE MessageBox",boxMessage:"",boxButtons:[],boxHeaderButtons:[],boxButtonDefaultPosition:1,boxButtonAlign:"right",boxAutoClose:{timeout:0,message:"Closing in %s% seconds...",container:"message"},boxAlternateReturn:{selector:"",close:!0},boxFocusOnLoad:{selector:""},dataParams:[],defaultStyle:"style01",topPosition:"100px",closeOnClickModal:!0,blockWhenOpen:!1,effects:{modalIn:"fadeIn",modalOut:"fadeOut",boxIn:"fadeInDown",boxOut:"fadeOutUp"},onSuccess:function(t){},onBeforeShow:function(t){},onAfterShow:function(t){},onBeforeClose:function(t){},onAfterClose:function(t){},onModalClosing:function(t){},onModalClosed:function(t){}};a&&(e=t.extend(!0,{},r,e,n)),n=t.extend(!0,{},r,e,n);var i=t.extend(!0,{},e,n),s={},l=["em","rem","ex","px","%","pt","pc","mm","cm","in","vh","vw","vmin","vmax","ch"];s._doValid_boxType=function(){return i.boxType},s._doValid_boxShortcuts=function(){var t=i.boxShortcuts;return t.enabled?t.enabled=!0:t.enabled=!1,t.showShortcutLabel?t.showShortcutLabel=!0:t.showShortcutLabel=!1,t},s._doValid_boxSize=function(){var e,n,a=i.boxSize,r=["330","420","585","880","100"],s=["xs","sm","md","lg","full"],c=t.inArray(a,s);return c>=0?(n=r[c],e="full"==s[c]?"%":"px"):(e=a.replace(/[0-9]/g,""),n=parseInt(a),(""===n||0>n||isNaN(n))&&t.error(o+"The paramater 'boxSize' it has to be a no empty and integer."),-1==t.inArray(e,l)&&t.error(o+"The allowable values for the parameter 'boxSize' are "+l.splice(0)+".")),n+e},s._doValid_boxTitle=function(){return i.boxTitle},s._doValid_boxMessage=function(){return i.boxMessage},s._doValid_boxButtons=function(){var e=i.boxButtons,n=i.boxShortcuts;t.isArray(e)||t.error(o+"The paramater 'boxButtons' it has to be a array of objects.");var a={label:"","class":"btn","return":"OK",close:!0,iconClass:"",shortcutCharCode:null,props:{element:"button",attribs:{}}};e.length<=0?e.push(a):"";for(var r={9:"TAB",13:"ENTER"},s=0;s<e.length;s++){e[s]=t.extend(!0,{},a,e[s]),""===e[s].label&&""===e[s].iconClass&&(e[s].label="OK");var l="";if(n.showShortcutLabel){l=String.fromCharCode(e[s].shortcutCharCode);var c=l.charCodeAt();0!==c&&(l=r.hasOwnProperty(c)?r[c]:l,e[s].label+=" <strong>["+l+"]</strong>")}var u=e[s].props.element;(""===u||t.isNumeric(u))&&t.error(o+"The paramater 'boxButtons[props][element]' it has to be a html element.")}return e},s._doValid_boxHeaderButtons=function(){var e=i.boxHeaderButtons;t.isArray(e)||t.error(o+"The paramater 'boxHeaderButtons' it has to be a array of objects.");var n={"return":"OK",close:!0,iconClass:"fa fa-close",props:{element:"li",attribs:{}}};e.length<=0?e.push(n):"";for(var a=0;a<e.length;a++){e[a]=t.extend(!0,{},n,e[a]);var r=e[a].props.element;(""===r||t.isNumeric(r))&&t.error(o+"The paramater 'boxHeaderButtons[props][element]' it has to be a html element.")}return e},s._doValid_boxTypeIcon=function(){var e=i.boxTypeIcon,n={type:"img",val:"none.png"};for(var a in e)e[a]=t.extend(!0,{},n,e[a]);return e.hasOwnProperty(i.boxType)||t.error(o+"The paramater 'boxTypeIcon' must have a position with the same type of parameter 'boxType'."),e},s._doValid_boxFocusOnLoad=function(){var e=i.boxFocusOnLoad,o={selector:""};return e=t.extend(!0,{},o,e)},s._doValid_boxButtonDefaultPosition=function(){var e=parseInt(i.boxButtonDefaultPosition-1);return(""===e||0>e||isNaN(e))&&t.error(o+"The paramater 'boxButtonDefaultPosition' it has to be a no empty and integer."),i.boxButtons.length>0&&void 0===i.boxButtons[e]&&t.error(o+"Not found an button in the position "+(e+1)+" in 'boxButtonDefaultPosition'."),e},s._doValid_boxAlternateReturn=function(){var t=i.boxAlternateReturn;return t},s._doValid_boxButtonAlign=function(){var e=i.boxButtonAlign,n=["left","right","center"];return-1==t.inArray(e,n)&&t.error(o+"The allowable values for the parameter 'boxButtonAlign' are "+n.splice(0)+"."),e},s._doValid_boxAutoClose=function(){var e=i.boxAutoClose;return t.isNumeric(e.timeout)||t.error(o+"The paramater 'boxAutoClose[timeout]' it has to be a no empty and integer."),e.timeout=1e3*e.timeout,e},s._doValid_defaultStyle=function(){return i.defaultStyle},s._doValid_dataParams=function(){return i.dataParams},s._doValid_topPosition=function(){var e=i.topPosition,n=e.replace(/[0-9]/g,"");parseInt(e);return-1==t.inArray(n,l)&&t.error(o+"The allowable values for the parameter 'topPosition' are "+l.splice(0)+"."),e},s._doValid_closeOnClickModal=function(){var t=i.closeOnClickModal;return t=t?!0:!1},s._doValid_boxReloadModal=function(){var t=i.boxReloadModal;return t=t?!0:!1},s._doValid_boxShowIcon=function(){var t=i.boxShowIcon;return t=t?!0:!1},s._doValid_boxShowHeaderControls=function(){var t=i.boxShowHeaderControls;return t=t?!0:!1},s._doValid_blockWhenOpen=function(){var t=i.blockWhenOpen;return t=t?!0:!1},s._doValid_effects=function(){var t=i.effects;return t},s._doValid_onSuccess=function(){var e="onSuccess";return t.isFunction(i[e])||t.error(o+"The paramater '"+e+"' it has to be a function."),i[e]},s._doValid_onBeforeShow=function(){var e="onBeforeShow";return t.isFunction(i[e])||t.error(o+"The paramater '"+e+"' it has to be a function."),i[e]},s._doValid_onAfterShow=function(){var e="onAfterShow";return t.isFunction(i[e])||t.error(o+"The paramater '"+e+"' it has to be a function."),i[e]},s._doValid_onBeforeClose=function(){var e="onBeforeClose";return t.isFunction(i[e])||t.error(o+"The paramater '"+e+"' it has to be a function."),i[e]},s._doValid_onAfterClose=function(){var e="onAfterClose";return t.isFunction(i[e])||t.error(o+"The paramater '"+e+"' it has to be a function."),i[e]},s._doValid_onModalClosing=function(){var e="onModalClosing";return t.isFunction(i[e])||t.error(o+"The paramater '"+e+"' it has to be a function."),i[e]},s._doValid_onModalClosed=function(){var e="onModalClosed";return t.isFunction(i[e])||t.error(o+"The paramater '"+e+"' it has to be a function."),i[e]};var c=function(){for(var e in i)r.hasOwnProperty(e)?u(e):t.error(o+"Setting '"+e+"' is not recognized as a word without making dictionary plugin.")},u=function(e){var n="_doValid_"+e;return s.hasOwnProperty(n)||t.error(o+"Setting '"+e+"' needs a validation function."),i[e]=s[n](),!0};return c(),this.getAMBObject=function(){return i},this.getAMBSetting=function(t){return i[t]},this},t.allSIGEDynamicMessageBox=function(e){var n,a,r=t.allSIGEDynamicMessageBoxSettings(e).getAMBObject(),i=500,s=!1,l={modal:{tag:"div",styleClass:"message-box-modal",showModal:!0,getContainer:function(){return"body"},getDataSelector:function(t){void 0==t?t=!0:"";var e="box-modal";return e=t?this.tag+'[data-amb-skel="'+e+'"]':e},doOpen:function(){this.showModal&&(t(this.getDataSelector()).addClass(r.effects.modalIn),t(this.getDataSelector()).addClass("animated"),t(this.getDataSelector()).show())},doClose:function(){t(this.getDataSelector()).removeClass(r.effects.modalIn),t(this.getDataSelector()).addClass(r.effects.modalOut);var e=this;r.onModalClosing(k()),window.setTimeout(function(){t(e.getDataSelector()).hide(),r.onModalClosed(k())},i)}},container:{tag:"div",styleClass:"message-box-container",hasSpecialConfig:!0,getContainer:function(){return"body"},getDataSelector:function(t){void 0==t?t=!0:"";var e="box-container";return e=t?this.tag+'[data-amb-skel="'+e+'"]':e},doOpen:function(){t(this.getDataSelector()).show()},doClose:function(){var e=this;window.setTimeout(function(){t(e.getDataSelector()).hide()},i)},doSpecialConfig:function(){t(this.getDataSelector()).animate({scrollTop:0},"fast")}},main:{tag:"section",styleClass:"message-box-body",hasSpecialConfig:!0,getContainer:function(){return l.container.getDataSelector()},getDataSelector:function(t){void 0==t?t=!0:"";var e="box-main";return e=t?this.tag+'[data-amb-skel="'+e+'"]':e},doOpen:function(){t(this.getDataSelector()).addClass(r.effects.boxIn),t(this.getDataSelector()).addClass("animated"),t(this.getDataSelector()).show()},doClose:function(){t(this.getDataSelector()).removeClass(r.effects.boxIn),t(this.getDataSelector()).addClass(r.effects.boxOut);var e=this;window.setTimeout(function(){t(e.getDataSelector()).hide()},i)},setBoxType:function(e){var o=this.styleClass+"-"+e,n=this.styleClass+"-"+r.boxType;t(this.getDataSelector()).hasClass(n)&&t(this.getDataSelector()).removeClass(n),t(this.getDataSelector()).addClass(o)},setBoxSize:function(e,o){o=void 0===o?!0:o,o?t(this.getDataSelector()).animate({width:e},i):t(this.getDataSelector()).css("width",e)},setTopPosition:function(e,o,n){o=void 0===o?!0:o,o?t(this.getDataSelector()).animate({"margin-top":e,"margin-bottom":e},i,function(){void 0!==n&&n()}):(t(this.getDataSelector()).css("margin-top",e),t(this.getDataSelector()).css("margin-bottom",e))},setDefaultStyle:function(e){t(this.getDataSelector()).removeClass(r.defaultStyle),t(this.getDataSelector()).addClass(e)},doSpecialConfig:function(){this.setDefaultStyle(r.defaultStyle),this.setTopPosition(r.topPosition,!1),this.setBoxType(r.boxType),this.setBoxSize(r.boxSize,!1)}},header:{tag:"header",styleClass:"message-box-header",getContainer:function(){return l.main.getDataSelector()},getDataSelector:function(t){void 0==t?t=!0:"";var e="box-header";return e=t?this.tag+'[data-amb-skel="'+e+'"]':e}},"header-content":{tag:"div",styleClass:"content",getContainer:function(){return l.header.getDataSelector()},getDataSelector:function(t){void 0==t?t=!0:"";var e="box-header-content";return e=t?this.tag+'[data-amb-skel="'+e+'"]':e},setContent:function(e){t(this.getDataSelector()).html(e)}},"header-options":{tag:"ul",styleClass:"options",hasSpecialConfig:!0,getContainer:function(){return l.header.getDataSelector()},getDataSelector:function(t){void 0==t?t=!0:"";var e="box-header-options";return e=t?this.tag+'[data-amb-skel="'+e+'"]':e},setContent:function(e){t(this.getDataSelector()).html(e)},setBoxShowHeaderControls:function(t){this.setContent(""),t&&this.setContent(C())},doSpecialConfig:function(){this.setBoxShowHeaderControls(r.boxShowHeaderControls)}},message:{tag:"div",styleClass:"message-box-message",getContainer:function(){return l.main.getDataSelector()},getDataSelector:function(t){void 0==t?t=!0:"";var e="box-message";return e=t?this.tag+'[data-amb-skel="'+e+'"]':e}},"message-content":{tag:"div",styleClass:"content",hasSpecialConfig:!0,getContainer:function(){return l.message.getDataSelector()},getDataSelector:function(t){void 0==t?t=!0:"";var e="box-message-content";return e=t?this.tag+'[data-amb-skel="'+e+'"]':e},setContent:function(e){t(this.getDataSelector()).html(e)},doSpecialConfig:function(){var t=r.boxShowIcon;t&&(l["message-icon"].doSpecialConfig(),d("message-icon"))}},footer:{tag:"footer",styleClass:"message-box-footer",getContainer:function(){return l.main.getDataSelector()},getDataSelector:function(t){void 0==t?t=!0:"";var e="box-footer";return e=t?this.tag+'[data-amb-skel="'+e+'"]':e}},"footer-content":{tag:"div",styleClass:"buttons",hasSpecialConfig:!0,getContainer:function(){return l.footer.getDataSelector()},getDataSelector:function(t){void 0==t?t=!0:"";var e="box-footer-content";return e=t?this.tag+'[data-amb-skel="'+e+'"]':e},setContent:function(e){t(this.getDataSelector()).html(e)},doSpecialConfig:function(){t(this.getDataSelector()).css("text-align",r.boxButtonAlign)}},timeout:{tag:"p",styleClass:"message-box-timeout",isBlockAutoCreate:!0,getContainer:function(){var t=r.boxAutoClose.container;return c(t),l[t].getDataSelector()},getDataSelector:function(t){void 0==t?t=!0:"";var e="box-timeout";return e=t?this.tag+'[data-amb-skel="'+e+'"]':e},setContent:function(e){t(this.getDataSelector()).html(e)}},"message-icon":{tag:"span",styleClass:"message-box-icon",isBlockAutoCreate:!0,hasSpecialConfig:!0,getContainer:function(){return l["message-content"].getDataSelector()},getDataSelector:function(t){void 0==t?t=!0:"";var e="box-message-icon";return e=t?this.tag+'[data-amb-skel="'+e+'"]':e},setContent:function(e){t(this.getDataSelector()).html(e)},doSpecialConfig:function(){var e=r.boxTypeIcon,o=e[r.boxType];if("img"==o.type){l["message-icon"].tag="img";var n=t(this.getDataSelector());n.attr("src","img/"+o.val)}else{l["message-icon"].tag="span";var n=t(this.getDataSelector());n.addClass(o.val)}}}},c=function(e){return l.hasOwnProperty(e)?!0:(t.error(o+"The type informed is a invalid type."),!1)},u=function(e){return t(l[e].getDataSelector()).is(":visible")},d=function(e){c(e);var o=t("<"+l[e].tag+">",{"class":l[e].styleClass});t(o).attr("data-amb-skel",l[e].getDataSelector(!1)),t(o).appendTo(l[e].getContainer()),l[e].hasSpecialConfig&&l[e].doSpecialConfig()},f=function(e){c(e),t(l[e].getDataSelector()).remove()},g="amb-box-return",h="amb-box-close",b="data-amb-control",m="control",x="label",S="icon",p=function(e){t(t(l["footer-content"].getContainer()).find("["+b+"="+m+"]")).get(e).click()},v=function(){for(var e=[],o=0;o<r.boxButtons.length;o++){var n=r.boxButtons[o].label,a=r.boxButtons[o]["class"],i=r.boxButtons[o]["return"],s=r.boxButtons[o].iconClass,l=r.boxButtons[o].close,c=r.boxButtons[o].props,u=t("<"+c.element+">",{"class":a}),d=t("<span>",{"class":s});if(c.hasOwnProperty("attribs")&&!t.isEmptyObject(c.attribs)){var f="";for(f in c.attribs)t(u).attr(f,c.attribs[f])}if(t(u).attr(b,m),t(u).data(g,i),t(u).data(h,l),""!=n){var p=t("<span>").html(n);t(p).attr(b,x),t(u).html(p)}""!=s&&(t(d).prependTo(u),t(d).attr(b,S)),e.push(u)}return e},C=function(){for(var e=[],o=r.boxHeaderButtons,n=0;n<o.length;n++){var a=r.boxHeaderButtons[n]["return"],i=r.boxHeaderButtons[n].iconClass,s=r.boxHeaderButtons[n].close,l=r.boxHeaderButtons[n].props,c=t("<"+l.element+">",{"class":"control"}),u=t("<span>",{"class":i});if(l.hasOwnProperty("attribs")&&!t.isEmptyObject(l.attribs)){var d="";for(d in l.attribs)t(c).attr(d,l.attribs[d])}t(c).attr(b,m),t(c).data(g,a),t(c).data(h,s),t(c).append(u),e.push(c)}return e},y=function(e){setTimeout(function(){t(t(l["footer-content"].getContainer()+" ["+b+"="+m+"]:eq("+e+")")).focus()},100)},B=function(e){var o=l.modal.getContainer()+" "+e+":eq(0)";t(o).length>0?setTimeout(function(){t(o).focus()},100):y(0)},D=function(){for(var e in l)if(!l[e].isBlockAutoCreate){if("modal"==e&&t(l[e].getDataSelector()).is(":visible")&&!r.boxReloadModal)continue;d(e)}l["header-content"].setContent(r.boxTitle),l["message-content"].setContent(r.boxMessage),l["footer-content"].setContent(v()),V(),P(),A(),z(),r.boxShortcuts.enabled&&O()},T=function(){s=!0,r.onBeforeShow(k()),l.modal.doOpen(),l.container.doOpen(),l.main.doOpen(),r.onAfterShow(k())},w=function(){s=!1,r.onBeforeClose(k()),l.modal.doClose(),l.container.doClose(),l.main.doClose(),r.onAfterClose(k()),t("html").off("keydown"),E(),M(!0)},_=function(t){for(var e in l)("modal"!=e||!F||t||r.boxReloadModal)&&f(e)},M=function(t){void 0===t?t=!1:"",t?window.setTimeout(function(){_(t)},500):_(t)},A=function(){r.closeOnClickModal&&t(l.container.getDataSelector()).click(function(e){t(e.target).data("amb-skel")==l.container.getDataSelector(!1)&&w()})},O=function(){t("html").off("keydown"),t("html").on("keydown",function(t){var e="number"==typeof t.which?t.which:t.keyCode;e==r.boxShortcuts.closeKeyCode&&u("container")&&w();var o=0;for(var n in r.boxButtons){var a=r.boxButtons[n].shortcutCharCode;void 0!=a&&e==a&&p(o),o++}})},I=function(t,e,o){var n={};n.result=t,n.resultLocation=o,n.dataParams=r.dataParams,r.onSuccess(n),e&&w()},k=function(){var t={};return t.result="onEvent",t.dataParams=r.dataParams,t},P=function(){var e=t(l["footer-content"].getDataSelector()).selector+","+t(l["header-options"].getDataSelector()).selector;t(e).find("["+b+"="+m+"]").click(function(){var e=t(this).data(g),o=t(this).data(h);I(e,o,"BUT")})},V=function(){var e=r.boxAlternateReturn;""!==e.selector&&t(e.selector).click(function(){I(t(e.selector).get(0),e.close,"ALT")})},H=function(){var t=r.boxButtonDefaultPosition,e=r.boxFocusOnLoad;return""!=e.selector?(B(e.selector),"loadFocus"):(y(t),"buttonFocus")},E=function(){clearInterval(n),clearTimeout(a)},z=function(){var t=r.boxAutoClose.timeout,e=r.boxAutoClose.message,o=function(t){return e.replace("%s%",t)};if(t>0){d("timeout");var i=function(t){l.timeout.setContent(o(t))},s=t/1e3;i(s),n=setInterval(function(){s--,i(s)},1e3),a=setTimeout(function(){w(),clearInterval(n)},t)}},F=!1,G=function(){var e=!1;t(l.container.getDataSelector()).length>=1&&(e=r.blockWhenOpen,F=!0,e||M(!1)),e||(D(),T(),H())};return G(),this.getMBSettings=function(){return l},this.isOpen=function(){return s},this.setBoxType=function(e){var e=t.allSIGEDynamicMessageBoxSettings({boxType:e}).getAMBSetting("boxType");return l.main.setBoxType(e),this},this.setBoxShowHeaderControls=function(e){var e=t.allSIGEDynamicMessageBoxSettings({boxShowHeaderControls:e}).getAMBSetting("boxShowHeaderControls");return l["header-options"].setBoxShowHeaderControls(e),this},this.setBoxSize=function(e,o){var e=t.allSIGEDynamicMessageBoxSettings({boxSize:e}).getAMBSetting("boxSize");return l.main.setBoxSize(e,o),this},this.setTopPosition=function(e,o,n){var e=t.allSIGEDynamicMessageBoxSettings({topPosition:e}).getAMBSetting("topPosition");return l.main.setTopPosition(e,o,n),this},this.setDefaultStyle=function(e){var e=t.allSIGEDynamicMessageBoxSettings({defaultStyle:e}).getAMBSetting("defaultStyle");return l.main.setDefaultStyle(e),this},this.setBoxMessage=function(e){var e=t.allSIGEDynamicMessageBoxSettings({boxMessage:e}).getAMBSetting("boxMessage");return l["message-content"].setContent(e),this},this.setBoxTitle=function(e){var e=t.allSIGEDynamicMessageBoxSettings({boxTitle:e}).getAMBSetting("boxTitle");return l["header-content"].setContent(e),this},this}}(jQuery);